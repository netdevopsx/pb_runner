---
- name: Apply configuration
  hosts: all
  gather_facts: no
  connection: network_cli
  vars_files:
    - secrets.yml
  tasks:
    - name: Pull running configuration from device
      nxos_facts:
        gather_subset: config
      when: ansible_net_config is not defined

    - name: Parse configuration looking for NTP
      set_fact:
        ntp_cfg_1: "{{ ansible_net_config | parse_cli_textfsm('ntp_cfg_1.fsm') }}"

    - name: Show ntp_cfg_1
      debug:
        msg: "{{ ntp_cfg_1 }}"
